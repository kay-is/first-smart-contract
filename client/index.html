<!DOCTYPE html>

<meta charset="utf-8" />

<script type="module">
  import {
    h,
    render,
  } from "https://unpkg.com/preact@10.6.1/dist/preact.module.js"
  import htm from "https://unpkg.com/htm@3.1.0/dist/htm.module.js"
  import { ethers } from "https://unpkg.com/ethers@5.5.1/dist/ethers.esm.min.js"

  const html = htm.bind(h)

  const provider = new ethers.providers.Web3Provider(window.ethereum, "any")
  await provider.send("eth_requestAccounts", [])

  const signer = provider.getSigner()

  const contractAddress = "0x5FbDB2315678afecb367f032d93F642f64180aa3"
  const contractAbi = [
    "function createFundraiser(string memory name, string memory url, string memory imageUrl, string memory description, address payable beneficiary) public",
    "function fundraisersCount() public view returns (uint256)",
    "function fundraisers(uint256 limit, uint256 offset) public view returns (Fundraiser[] memory selection)",
  ]

  const contract = new ethers.Contract(contractAddress, contractAbi, signer)

  const fundraisersCount = await contract.fundraisersCount()

  function App(props) {
    return html`<h1>FundraisersCount: ${props.name}</h1>`
  }

  render(html`<${App} name=${fundraisersCount.toString()} />`, document.body)
</script>
